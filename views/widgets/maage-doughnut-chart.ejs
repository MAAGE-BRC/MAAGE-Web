<% var widgetId = 'maage-doughnut-' + Math.random().toString(36).substr(2, 9); %>
<div class="grid-stack-item-content bg-white rounded-lg border border-maage-border shadow-sm p-4">
  <div class="chart-widget">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-medium text-maage-text-primary">Host Groups</h3>
      <div class="flex gap-2">
        <button class="chart-toggle-btn px-3 py-1.5 bg-maage-primary-500 hover:bg-maage-primary-600 text-white rounded-md text-sm" data-view="chart">
          üç© Chart
        </button>
        <button class="chart-toggle-btn px-3 py-1.5 bg-maage-secondary-500 hover:bg-maage-secondary-600 text-white rounded-md text-sm" data-view="table">
          üìã Table
        </button>
      </div>
    </div>
    
    <div class="chart-container" style="width: 100%; height: 280px; position: relative;">
      <div class="chart-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <div class="text-center">
          <div class="animate-spin inline-block w-6 h-6 border-[3px] border-current border-t-transparent text-maage-primary-500 rounded-full mb-2"></div>
          <span class="text-maage-text-muted text-sm">Loading chart data...</span>
        </div>
      </div>
      <div class="chart-content" style="display: none; width: 100%; height: 100%;"></div>
      <div class="table-content" style="display: none; width: 100%; height: 100%; overflow: auto;">
        <table class="w-full">
          <thead>
            <tr class="border-b">
              <th class="text-left p-2">Host Group</th>
              <th class="text-left p-2">Count</th>
            </tr>
          </thead>
          <tbody class="table-data"></tbody>
        </table>
      </div>
    </div>
  </div>
  
  <script>
    (function() {
      const container = document.currentScript.parentElement;
      
      // Initialize widget using the base class
      if (window.MAAGEDoughnutChart) {
        const widget = new MAAGEDoughnutChart(container, {
          chartTitle: 'Host Groups',
          facetField: 'geographic_group',
          sampleData: {
            'Human': 65, 'Avian': 45, 'Swine': 32, 'Environmental': 28, 'Unknown': 15
          },
          sortBy: 'value',
          limit: 8
        });
        
        // Store widget reference for cleanup
        container._widget = widget;
      } else {
        console.error('MAAGEDoughnutChart class not available');
      }
      
      // Cleanup on page unload
      window.addEventListener('beforeunload', function() {
        if (container._widget) {
          container._widget.destroy();
        }
      });
    })();
  </script>
</div>
<script>
    dojoConfig = {
        parseOnLoad: false,
        packages: [
            {name: 'lazyload', location: "../lazyload", main: 'lazyload'},
            {name: 'jDataView', location: '../jDataView/src', main: 'jdataview'},
            {name: "FileSaver", location: "../FileSaver", main: "FileSaver"}
        ]
    }
</script>
<script type="text/javascript" src="/js/msa/dist/msa.min.js"></script>
<script src="/js/bundle/bundle.js"></script>
<!-- P3 Home Announcements Feed -->
<script>
    $.getJSON("https://docs.patricbrc.org/_static/carousel.json", function (feed) {
        for (var i = 0; i < feed.length; i++) {

            var link = feed[i].link;
            var title = feed[i].title;
            var desc = feed[i].desc;
            var descSnippit = desc.split(" ", 20).join(" ");
            var img = feed[i].img;

            // $("#slides").append("<li class=\"slide\"><a href=\"" + link + "\" class=\"feed-link\"><h4 class=\"feed-title\">" + title + "</h4><img src=\"" + img + "\" class=\"feed-img\"></a></li>");

            $("#slides").append(
                `<li class="slide">
                    <a href="${link}" class="feed-link">
                        <h4 class="feed-title">${title}</h4>
                    </a>
                    <p class="feed-description">${descSnippit} ... <a href="${link}">read more</a></p>
                    <img src="${img}" class="feed-img">
                </li>`
            );

            $("#slides .slide").first().addClass("showing");
        }

        var slides = $('#slides .slide');
        var currentSlide = 0;
        var slideInterval = setInterval(nextSlide, 4000);

        function nextSlide() {
            slides[currentSlide].className = "slide";
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].className = "slide showing";
        }
    });
</script>
<!-- // use bundle.js
<script type="text/javascript" src="/js/cytoscape/dist/cytoscape.min.js"></script>
<script type="text/javascript" src="/js/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="/js/webcola/WebCola/cola.min.js"></script>
<script type="text/javascript" src="/js/dagre/dist/dagre.min.js"></script>
<script type="text/javascript" src="/js/cytoscape-cose-bilkent/cytoscape-cose-bilkent.js"></script>
-->
<script type="text/javascript" src="/js/clipboard-js/clipboard.min.js"></script>
<% if (request && request.production){ %>
    <script src="/js/<%- request.package.version %>/dojo/dojo.js"></script>
    <script>
        require(<%- JSON.stringify(request.productionLayers) %>, function(){
<% } else { %>
    <script src="/js/dojo/dojo.js"></script>
    <script>
<% } %>
        require(["<%= request.applicationModule %>"], function(App){
            appOpts = <%- JSON.stringify(request.applicationOptions || {}) %>;
            appOpts.workspaceAPI = "<%= request.applicationOptions.workspaceServiceURL %>";
            appOpts.serviceAPI = "<%= request.applicationOptions.appServiceURL %>";
            appOpts.dataAPI = "<%= request.applicationOptions.dataServiceURL %>";
            <% if (request && request.session) { %>
                <% if (request.session.userProfile) { %>
            appOpts.authorizationToken = "<%- (request && request.session) ? (request.session.authorizationToken || request.session.accessToken) : "" %>";
                <% } %>
                <% if (request.session.userProfile) { %>
            appOpts.user = <%- JSON.stringify(request.session.userProfile) %>;
                <% } %>
            <% } %>
            window.App = new App(appOpts);
        });
    <% if (request && request.production){ %>
    });
<% } %>
</script>
<% if (request && request.applicationOptions.gaID) { %>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=<%- request.applicationOptions.gaID %>"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '<%- request.applicationOptions.gaID %>', {
        'link_attribution': true
    });
    </script>
<% } %>
